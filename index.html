<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LifeLink ‚Äî Blood Donation Network</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --crimson: #C0392B;
    --deep-red: #922B21;
    --dark: #0D0D0D;
    --dark2: #1A1A1A;
    --dark3: #242424;
    --card-bg: #1E1E1E;
    --border: rgba(192,57,43,0.25);
    --text: #F0EBE8;
    --muted: #8A8278;
    --accent: #E74C3C;
    --success: #27AE60;
    --gold: #D4AC0D;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--dark);
    color: var(--text);
    font-family: 'DM Sans', sans-serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  /* NAV */
  nav {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    background: rgba(13,13,13,0.9);
    backdrop-filter: blur(12px);
    border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 2rem; height: 64px;
  }

  .logo {
    font-family: 'Playfair Display', serif;
    font-weight: 900; font-size: 1.5rem;
    color: var(--crimson);
    letter-spacing: -1px;
    display: flex; align-items: center; gap: 8px;
  }
  .logo span { color: var(--text); }

  nav ul { list-style: none; display: flex; gap: 0.25rem; }
  nav ul li a, .nav-btn {
    background: none; border: none; cursor: pointer;
    padding: 0.4rem 1rem; border-radius: 6px;
    font-family: 'DM Sans', sans-serif;
    font-size: 0.9rem; font-weight: 500; color: var(--muted);
    text-decoration: none;
    transition: color 0.2s, background 0.2s;
  }
  nav ul li a:hover, .nav-btn:hover { color: var(--text); background: rgba(255,255,255,0.06); }
  .nav-btn.active { color: var(--text); background: rgba(192,57,43,0.15); color: var(--accent); }

  .nav-cta {
    background: var(--crimson); color: #fff !important;
    padding: 0.45rem 1.2rem; border-radius: 8px;
    font-weight: 600; font-size: 0.85rem;
    border: none; cursor: pointer;
    transition: background 0.2s;
    font-family: 'DM Sans', sans-serif;
  }
  .nav-cta:hover { background: var(--deep-red); }

  /* PAGES */
  .page { display: none; padding-top: 80px; min-height: 100vh; }
  .page.active { display: block; }

  /* HERO */
  #page-home {
    display: none;
    background: radial-gradient(ellipse at 70% 30%, rgba(192,57,43,0.12) 0%, transparent 60%),
                radial-gradient(ellipse at 20% 80%, rgba(146,43,33,0.08) 0%, transparent 50%),
                var(--dark);
  }
  #page-home.active { display: block; }

  .hero {
    padding: 5rem 2rem 3rem;
    max-width: 1100px; margin: 0 auto;
    display: grid; grid-template-columns: 1fr 1fr; gap: 4rem; align-items: center;
  }

  .hero-eyebrow {
    font-size: 0.75rem; font-weight: 600; letter-spacing: 3px;
    text-transform: uppercase; color: var(--crimson); margin-bottom: 1rem;
  }

  .hero h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 900; line-height: 1.05;
    margin-bottom: 1.5rem;
  }
  .hero h1 em { color: var(--crimson); font-style: normal; }

  .hero p { font-size: 1.05rem; color: var(--muted); line-height: 1.7; margin-bottom: 2rem; }

  .hero-btns { display: flex; gap: 1rem; flex-wrap: wrap; }
  .btn-primary {
    background: var(--crimson); color: #fff;
    padding: 0.75rem 1.75rem; border-radius: 10px;
    font-weight: 600; font-size: 0.95rem; border: none; cursor: pointer;
    transition: background 0.2s, transform 0.15s;
    font-family: 'DM Sans', sans-serif;
  }
  .btn-primary:hover { background: var(--deep-red); transform: translateY(-1px); }

  .btn-outline {
    background: transparent; color: var(--text);
    padding: 0.75rem 1.75rem; border-radius: 10px;
    font-weight: 600; font-size: 0.95rem;
    border: 1px solid rgba(255,255,255,0.15); cursor: pointer;
    transition: border-color 0.2s, background 0.2s;
    font-family: 'DM Sans', sans-serif;
  }
  .btn-outline:hover { border-color: var(--crimson); background: rgba(192,57,43,0.08); }

  .hero-visual {
    display: flex; align-items: center; justify-content: center;
    position: relative;
  }

  .blood-drop-bg {
    width: 280px; height: 280px;
    background: radial-gradient(circle at 40% 40%, rgba(192,57,43,0.35), rgba(146,43,33,0.15));
    border-radius: 50% 50% 50% 0;
    transform: rotate(-45deg);
    position: relative;
    animation: float 4s ease-in-out infinite;
    border: 1px solid rgba(192,57,43,0.3);
    box-shadow: 0 0 80px rgba(192,57,43,0.2);
  }

  @keyframes float {
    0%, 100% { transform: rotate(-45deg) translateY(0); }
    50% { transform: rotate(-45deg) translateY(-12px); }
  }

  .stats-grid {
    max-width: 1100px; margin: 2rem auto; padding: 0 2rem;
    display: grid; grid-template-columns: repeat(3,1fr); gap: 1rem;
  }

  .stat-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 12px; padding: 1.5rem;
    text-align: center;
  }
  .stat-card .num {
    font-family: 'Playfair Display', serif;
    font-size: 2.2rem; font-weight: 900; color: var(--crimson);
  }
  .stat-card p { font-size: 0.85rem; color: var(--muted); margin-top: 0.25rem; }

  /* SECTIONS */
  .section { max-width: 1100px; margin: 0 auto; padding: 2rem; }

  .section-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.8rem; font-weight: 700; margin-bottom: 0.5rem;
  }
  .section-sub { color: var(--muted); margin-bottom: 2rem; font-size: 0.95rem; }

  /* FORMS */
  .form-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 16px; padding: 2.5rem;
    max-width: 680px;
  }

  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
  .form-group { margin-bottom: 1.2rem; }
  .form-group label {
    display: block; font-size: 0.82rem; font-weight: 600;
    letter-spacing: 0.5px; color: var(--muted); margin-bottom: 0.5rem;
    text-transform: uppercase;
  }
  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 100%; background: var(--dark3);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 8px; padding: 0.7rem 1rem;
    color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.95rem;
    outline: none; transition: border-color 0.2s;
  }
  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus { border-color: var(--crimson); }
  .form-group select { appearance: none; cursor: pointer; }
  .form-group textarea { resize: vertical; min-height: 80px; }

  .checkbox-group { display: flex; align-items: center; gap: 0.6rem; }
  .checkbox-group input[type=checkbox] { width: auto; accent-color: var(--crimson); }
  .checkbox-group label { text-transform: none; letter-spacing: 0; font-size: 0.9rem; }

  .btn-submit {
    background: var(--crimson); color: #fff;
    width: 100%; padding: 0.85rem; border-radius: 10px;
    font-weight: 600; font-size: 1rem; border: none; cursor: pointer;
    font-family: 'DM Sans', sans-serif;
    transition: background 0.2s, transform 0.15s;
    margin-top: 0.5rem;
  }
  .btn-submit:hover { background: var(--deep-red); transform: translateY(-1px); }

  /* SEARCH */
  .search-bar {
    display: flex; gap: 0.75rem; flex-wrap: wrap; margin-bottom: 2rem;
  }
  .search-bar input, .search-bar select {
    flex: 1; min-width: 160px;
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 10px; padding: 0.7rem 1rem;
    color: var(--text); font-family: 'DM Sans', sans-serif; font-size: 0.9rem;
    outline: none; transition: border-color 0.2s;
  }
  .search-bar input:focus, .search-bar select:focus { border-color: var(--crimson); }

  .btn-search {
    background: var(--crimson); color: #fff;
    padding: 0.7rem 1.5rem; border-radius: 10px;
    font-weight: 600; border: none; cursor: pointer;
    font-family: 'DM Sans', sans-serif; font-size: 0.9rem;
    transition: background 0.2s;
  }
  .btn-search:hover { background: var(--deep-red); }

  /* CARDS GRID */
  .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap: 1.25rem; }

  .donor-card, .request-card {
    background: var(--card-bg);
    border: 1px solid var(--border);
    border-radius: 14px; padding: 1.5rem;
    transition: border-color 0.2s, transform 0.2s;
    position: relative; overflow: hidden;
  }
  .donor-card:hover, .request-card:hover {
    border-color: rgba(192,57,43,0.5); transform: translateY(-2px);
  }

  .blood-badge {
    display: inline-flex; align-items: center; justify-content: center;
    width: 48px; height: 48px; border-radius: 50%;
    background: rgba(192,57,43,0.15); border: 1.5px solid var(--crimson);
    font-family: 'Playfair Display', serif; font-weight: 700;
    font-size: 0.9rem; color: var(--crimson); margin-bottom: 1rem;
  }

  .donor-name { font-weight: 600; font-size: 1.05rem; margin-bottom: 0.3rem; }
  .donor-meta { font-size: 0.82rem; color: var(--muted); display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1rem; }
  .donor-meta span { display: flex; align-items: center; gap: 4px; }

  .tag {
    display: inline-block; padding: 0.2rem 0.6rem;
    border-radius: 20px; font-size: 0.75rem; font-weight: 600;
    background: rgba(39,174,96,0.15); color: var(--success);
    border: 1px solid rgba(39,174,96,0.25);
  }
  .tag.unavailable { background: rgba(127,127,127,0.1); color: var(--muted); border-color: rgba(127,127,127,0.2); }
  .tag.urgent { background: rgba(192,57,43,0.15); color: var(--accent); border-color: rgba(192,57,43,0.3); }

  .btn-contact {
    width: 100%; margin-top: 1rem; padding: 0.55rem;
    border-radius: 8px; border: 1px solid var(--border);
    background: transparent; color: var(--text);
    font-family: 'DM Sans', sans-serif; font-size: 0.85rem; font-weight: 600;
    cursor: pointer; transition: background 0.2s, border-color 0.2s;
  }
  .btn-contact:hover { background: rgba(192,57,43,0.1); border-color: var(--crimson); }

  .urgency-bar {
    position: absolute; top: 0; left: 0; right: 0; height: 3px;
    background: var(--crimson);
    border-radius: 14px 14px 0 0;
  }

  /* HISTORY */
  .history-table {
    width: 100%; border-collapse: collapse;
    background: var(--card-bg); border-radius: 14px; overflow: hidden;
    border: 1px solid var(--border);
  }
  .history-table th {
    background: var(--dark3); padding: 0.9rem 1.2rem;
    text-align: left; font-size: 0.78rem; font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.8px; color: var(--muted);
  }
  .history-table td {
    padding: 0.9rem 1.2rem; border-top: 1px solid rgba(255,255,255,0.04);
    font-size: 0.9rem;
  }
  .history-table tr:hover td { background: rgba(192,57,43,0.04); }

  .history-empty { text-align: center; padding: 3rem; color: var(--muted); }

  /* TOAST */
  .toast {
    position: fixed; bottom: 2rem; right: 2rem;
    background: var(--success); color: #fff;
    padding: 0.85rem 1.5rem; border-radius: 10px;
    font-weight: 600; font-size: 0.9rem;
    transform: translateY(80px); opacity: 0;
    transition: transform 0.3s, opacity 0.3s;
    z-index: 999;
  }
  .toast.show { transform: translateY(0); opacity: 1; }
  .toast.error { background: var(--crimson); }

  .empty-state { text-align: center; padding: 4rem 2rem; color: var(--muted); }
  .empty-state h3 { font-family: 'Playfair Display', serif; font-size: 1.5rem; color: var(--text); margin-bottom: 0.5rem; }

  /* Pulse dot */
  .pulse-dot {
    display: inline-block; width: 8px; height: 8px;
    border-radius: 50%; background: var(--success);
    animation: pulse 2s infinite;
    margin-right: 6px;
  }
  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.4); }
  }

  @media (max-width: 768px) {
    .hero { grid-template-columns: 1fr; gap: 2rem; }
    .hero-visual { display: none; }
    .stats-grid { grid-template-columns: 1fr 1fr; }
    .form-row { grid-template-columns: 1fr; }
    nav ul { display: none; }
  }
</style>
</head>
<body>

<!-- NAVIGATION -->
<nav>
  <div class="logo">‚ù§ Life<span>Link</span></div>
  <ul>
    <li><button class="nav-btn active" onclick="showPage('home')">Home</button></li>
    <li><button class="nav-btn" onclick="showPage('register')">Register</button></li>
    <li><button class="nav-btn" onclick="showPage('search')">Find Donors</button></li>
    <li><button class="nav-btn" onclick="showPage('request')">Request Blood</button></li>
    <li><button class="nav-btn" onclick="showPage('history')">History</button></li>
  </ul>
  <button class="nav-cta" onclick="showPage('register')">+ Become a Donor</button>
</nav>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- ===== HOME ===== -->
<div class="page active" id="page-home">
  <div class="hero">
    <div>
      <div class="hero-eyebrow">ü©∏ Save lives today</div>
      <h1>Every drop counts. <em>Be someone's lifeline.</em></h1>
      <p>Connect blood donors with those in urgent need. Register as a donor, post blood requests, and track your donation journey ‚Äî all in one place.</p>
      <div class="hero-btns">
        <button class="btn-primary" onclick="showPage('register')">Donate Blood</button>
        <button class="btn-outline" onclick="showPage('request')">Request Blood</button>
      </div>
    </div>
    <div class="hero-visual">
      <div class="blood-drop-bg"></div>
    </div>
  </div>

  <div class="stats-grid" id="stats-grid">
    <div class="stat-card">
      <div class="num" id="stat-donors">0</div>
      <p>Registered Donors</p>
    </div>
    <div class="stat-card">
      <div class="num" id="stat-requests">0</div>
      <p>Blood Requests</p>
    </div>
    <div class="stat-card">
      <div class="num" id="stat-donations">0</div>
      <p>Donations Logged</p>
    </div>
  </div>
</div>

<!-- ===== REGISTER ===== -->
<div class="page" id="page-register">
  <div class="section">
    <div class="section-title">Donor Registration</div>
    <div class="section-sub">Join our network and help save lives.</div>
    <div class="form-card">
      <form id="register-form" onsubmit="registerDonor(event)">
        <div class="form-row">
          <div class="form-group">
            <label>First Name</label>
            <input type="text" id="r-fname" placeholder="John" required>
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" id="r-lname" placeholder="Doe" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="r-email" placeholder="john@example.com" required>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="r-phone" placeholder="+1 (555) 000-0000" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Blood Type</label>
            <select id="r-blood" required>
              <option value="">Select blood type</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option>
              <option>O+</option><option>O-</option>
            </select>
          </div>
          <div class="form-group">
            <label>Age</label>
            <input type="number" id="r-age" placeholder="25" min="18" max="65" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>City</label>
            <input type="text" id="r-city" placeholder="New York" required>
          </div>
          <div class="form-group">
            <label>State / Region</label>
            <input type="text" id="r-state" placeholder="NY">
          </div>
        </div>
        <div class="form-group">
          <label>Last Donation Date (if any)</label>
          <input type="date" id="r-lastdonation">
        </div>
        <div class="form-group">
          <div class="checkbox-group">
            <input type="checkbox" id="r-available" checked>
            <label for="r-available">I am currently available to donate</label>
          </div>
        </div>
        <button type="submit" class="btn-submit">Register as Donor</button>
      </form>
    </div>
  </div>
</div>

<!-- ===== SEARCH ===== -->
<div class="page" id="page-search">
  <div class="section">
    <div class="section-title">Find Donors</div>
    <div class="section-sub">Search our network by blood type or location.</div>
    <div class="search-bar">
      <select id="s-blood">
        <option value="">All Blood Types</option>
        <option>A+</option><option>A-</option>
        <option>B+</option><option>B-</option>
        <option>AB+</option><option>AB-</option>
        <option>O+</option><option>O-</option>
      </select>
      <input type="text" id="s-city" placeholder="City or location...">
      <label style="display:flex;align-items:center;gap:6px;font-size:0.85rem;color:var(--muted);white-space:nowrap;">
        <input type="checkbox" id="s-available" style="accent-color:var(--crimson)"> Available only
      </label>
      <button class="btn-search" onclick="searchDonors()">Search</button>
    </div>
    <div class="cards-grid" id="donors-list"></div>
  </div>
</div>

<!-- ===== REQUEST ===== -->
<div class="page" id="page-request">
  <div class="section">
    <div class="section-title">Post a Blood Request</div>
    <div class="section-sub">Let our donor network know you need blood urgently.</div>
    <div class="form-card">
      <form id="request-form" onsubmit="postRequest(event)">
        <div class="form-row">
          <div class="form-group">
            <label>Patient Name</label>
            <input type="text" id="req-name" placeholder="Jane Doe" required>
          </div>
          <div class="form-group">
            <label>Blood Type Needed</label>
            <select id="req-blood" required>
              <option value="">Select blood type</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option>
              <option>O+</option><option>O-</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Units Needed</label>
            <input type="number" id="req-units" placeholder="2" min="1" max="10" required>
          </div>
          <div class="form-group">
            <label>Urgency</label>
            <select id="req-urgency" required>
              <option value="">Select urgency</option>
              <option value="critical">Critical (Today)</option>
              <option value="urgent">Urgent (Within 24h)</option>
              <option value="normal">Normal (Within a week)</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Hospital / Location</label>
            <input type="text" id="req-hospital" placeholder="City Medical Center" required>
          </div>
          <div class="form-group">
            <label>City</label>
            <input type="text" id="req-city" placeholder="New York" required>
          </div>
        </div>
        <div class="form-group">
          <label>Contact Number</label>
          <input type="tel" id="req-phone" placeholder="+1 (555) 000-0000" required>
        </div>
        <div class="form-group">
          <label>Additional Notes</label>
          <textarea id="req-notes" placeholder="Any additional information..."></textarea>
        </div>
        <button type="submit" class="btn-submit">Post Blood Request</button>
      </form>
    </div>

    <div style="margin-top:3rem;">
      <div class="section-title" style="font-size:1.3rem;">Active Requests</div>
      <div style="height:0.5rem;"></div>
      <div class="cards-grid" id="requests-list"></div>
    </div>
  </div>
</div>

<!-- ===== HISTORY ===== -->
<div class="page" id="page-history">
  <div class="section">
    <div class="section-title">Donation History</div>
    <div class="section-sub">Log and track your donations over time.</div>

    <div class="form-card" style="margin-bottom:2.5rem;">
      <form id="history-form" onsubmit="logDonation(event)">
        <div class="form-row">
          <div class="form-group">
            <label>Donor Name</label>
            <input type="text" id="h-name" placeholder="John Doe" required>
          </div>
          <div class="form-group">
            <label>Blood Type</label>
            <select id="h-blood" required>
              <option value="">Select</option>
              <option>A+</option><option>A-</option>
              <option>B+</option><option>B-</option>
              <option>AB+</option><option>AB-</option>
              <option>O+</option><option>O-</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label>Date of Donation</label>
            <input type="date" id="h-date" required>
          </div>
          <div class="form-group">
            <label>Donation Center / Hospital</label>
            <input type="text" id="h-center" placeholder="City Blood Bank" required>
          </div>
        </div>
        <div class="form-group">
          <label>Units Donated</label>
          <input type="number" id="h-units" value="1" min="1" max="3">
        </div>
        <button type="submit" class="btn-submit">Log Donation</button>
      </form>
    </div>

    <div id="history-container">
      <table class="history-table" id="history-table">
        <thead>
          <tr>
            <th>Donor</th>
            <th>Blood Type</th>
            <th>Date</th>
            <th>Center</th>
            <th>Units</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="history-tbody"></tbody>
      </table>
      <div class="history-empty" id="history-empty" style="display:none;">
        <p>No donations logged yet. Log your first donation above!</p>
      </div>
    </div>
  </div>
</div>

<script>
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DATA STORE (localStorage)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const DB = {
  get: (key) => JSON.parse(localStorage.getItem('lifelink_' + key) || '[]'),
  set: (key, val) => localStorage.setItem('lifelink_' + key, JSON.stringify(val)),
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// NAV
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function showPage(page) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-' + page).classList.add('active');
  const btns = document.querySelectorAll('.nav-btn');
  btns.forEach(b => { if(b.textContent.toLowerCase().includes(page) || b.getAttribute('onclick')?.includes(`'${page}'`)) b.classList.add('active'); });
  if (page === 'home') updateStats();
  if (page === 'search') renderDonors(DB.get('donors'));
  if (page === 'request') renderRequests();
  if (page === 'history') renderHistory();
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// TOAST
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function toast(msg, type = 'success') {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = 'toast show' + (type === 'error' ? ' error' : '');
  setTimeout(() => t.className = 'toast', 3000);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STATS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function updateStats() {
  document.getElementById('stat-donors').textContent = DB.get('donors').length;
  document.getElementById('stat-requests').textContent = DB.get('requests').length;
  document.getElementById('stat-donations').textContent = DB.get('history').length;
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// REGISTER DONOR
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function registerDonor(e) {
  e.preventDefault();
  const donor = {
    id: Date.now(),
    fname: document.getElementById('r-fname').value.trim(),
    lname: document.getElementById('r-lname').value.trim(),
    email: document.getElementById('r-email').value.trim(),
    phone: document.getElementById('r-phone').value.trim(),
    blood: document.getElementById('r-blood').value,
    age: document.getElementById('r-age').value,
    city: document.getElementById('r-city').value.trim(),
    state: document.getElementById('r-state').value.trim(),
    lastDonation: document.getElementById('r-lastdonation').value,
    available: document.getElementById('r-available').checked,
    registeredAt: new Date().toLocaleDateString(),
  };
  const donors = DB.get('donors');
  donors.unshift(donor);
  DB.set('donors', donors);
  document.getElementById('register-form').reset();
  toast('‚úì Donor profile created successfully!');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SEARCH DONORS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function searchDonors() {
  const blood = document.getElementById('s-blood').value;
  const city = document.getElementById('s-city').value.trim().toLowerCase();
  const availOnly = document.getElementById('s-available').checked;
  let donors = DB.get('donors');
  if (blood) donors = donors.filter(d => d.blood === blood);
  if (city) donors = donors.filter(d => d.city.toLowerCase().includes(city) || d.state.toLowerCase().includes(city));
  if (availOnly) donors = donors.filter(d => d.available);
  renderDonors(donors);
}

function renderDonors(donors) {
  const el = document.getElementById('donors-list');
  if (!donors.length) {
    el.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><h3>No donors found</h3><p>Try adjusting your search filters.</p></div>`;
    return;
  }
  el.innerHTML = donors.map(d => `
    <div class="donor-card">
      <div class="blood-badge">${d.blood}</div>
      <div class="donor-name">${d.fname} ${d.lname}</div>
      <div class="donor-meta">
        <span>üìç ${d.city}${d.state ? ', ' + d.state : ''}</span>
        <span>üéÇ Age ${d.age}</span>
      </div>
      <span class="tag ${d.available ? '' : 'unavailable'}">
        ${d.available ? '‚óè Available' : '‚óè Unavailable'}
      </span>
      ${d.lastDonation ? `<div style="font-size:0.78rem;color:var(--muted);margin-top:0.5rem;">Last donated: ${d.lastDonation}</div>` : ''}
      <button class="btn-contact" onclick="contactDonor('${d.phone}')">Contact: ${d.phone}</button>
    </div>
  `).join('');
}

function contactDonor(phone) {
  toast(`üìû Contact number: ${phone}`);
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// POST REQUEST
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function postRequest(e) {
  e.preventDefault();
  const req = {
    id: Date.now(),
    name: document.getElementById('req-name').value.trim(),
    blood: document.getElementById('req-blood').value,
    units: document.getElementById('req-units').value,
    urgency: document.getElementById('req-urgency').value,
    hospital: document.getElementById('req-hospital').value.trim(),
    city: document.getElementById('req-city').value.trim(),
    phone: document.getElementById('req-phone').value.trim(),
    notes: document.getElementById('req-notes').value.trim(),
    postedAt: new Date().toLocaleDateString(),
  };
  const requests = DB.get('requests');
  requests.unshift(req);
  DB.set('requests', requests);
  document.getElementById('request-form').reset();
  renderRequests();
  toast('‚úì Blood request posted successfully!');
}

const urgencyLabel = { critical: 'Critical', urgent: 'Urgent', normal: 'Normal' };

function renderRequests() {
  const el = document.getElementById('requests-list');
  const requests = DB.get('requests');
  if (!requests.length) {
    el.innerHTML = `<div class="empty-state" style="grid-column:1/-1"><h3>No requests yet</h3><p>Post a request and reach donors near you.</p></div>`;
    return;
  }
  el.innerHTML = requests.map(r => `
    <div class="request-card">
      ${r.urgency === 'critical' ? '<div class="urgency-bar"></div>' : ''}
      <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:1rem;">
        <div class="blood-badge">${r.blood}</div>
        <span class="tag ${r.urgency === 'normal' ? '' : 'urgent'}">${urgencyLabel[r.urgency]}</span>
      </div>
      <div class="donor-name">${r.name}</div>
      <div class="donor-meta">
        <span>üè• ${r.hospital}</span>
        <span>üìç ${r.city}</span>
      </div>
      <div style="font-size:0.85rem;margin-bottom:0.75rem;">
        <strong>${r.units} unit${r.units > 1 ? 's' : ''}</strong> needed
        ${r.notes ? `<br><span style="color:var(--muted);font-size:0.8rem;">${r.notes}</span>` : ''}
      </div>
      <div style="font-size:0.78rem;color:var(--muted);">Posted ${r.postedAt}</div>
      <button class="btn-contact" onclick="toast('üìû Contact: ${r.phone}')">Contact: ${r.phone}</button>
      <button class="btn-contact" style="border-color:rgba(192,57,43,0.3);color:var(--accent);margin-top:0.5rem;" onclick="fulfillRequest(${r.id})">Mark as Fulfilled</button>
    </div>
  `).join('');
}

function fulfillRequest(id) {
  const requests = DB.get('requests').filter(r => r.id !== id);
  DB.set('requests', requests);
  renderRequests();
  toast('‚úì Request marked as fulfilled!');
}

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// DONATION HISTORY
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function logDonation(e) {
  e.preventDefault();
  const entry = {
    id: Date.now(),
    name: document.getElementById('h-name').value.trim(),
    blood: document.getElementById('h-blood').value,
    date: document.getElementById('h-date').value,
    center: document.getElementById('h-center').value.trim(),
    units: document.getElementById('h-units').value,
  };
  const history = DB.get('history');
  history.unshift(entry);
  DB.set('history', history);
  document.getElementById('history-form').reset();
  renderHistory();
  toast('‚úì Donation logged successfully!');
}

function renderHistory() {
  const history = DB.get('history');
  const tbody = document.getElementById('history-tbody');
  const empty = document.getElementById('history-empty');
  const table = document.getElementById('history-table');

  if (!history.length) {
    table.style.display = 'none';
    empty.style.display = 'block';
    return;
  }
  table.style.display = 'table';
  empty.style.display = 'none';

  tbody.innerHTML = history.map(h => `
    <tr>
      <td>${h.name}</td>
      <td><span class="tag" style="background:rgba(192,57,43,0.12);color:var(--crimson);border-color:var(--border);">${h.blood}</span></td>
      <td>${h.date}</td>
      <td>${h.center}</td>
      <td>${h.units}</td>
      <td>
        <button onclick="deleteHistory(${h.id})" style="background:none;border:none;color:var(--muted);cursor:pointer;font-size:0.85rem;" title="Delete">‚úï</button>
      </td>
    </tr>
  `).join('');
}

function deleteHistory(id) {
  const history = DB.get('history').filter(h => h.id !== id);
  DB.set('history', history);
  renderHistory();
  toast('Donation entry removed.');
}

// INIT
updateStats();
renderDonors(DB.get('donors'));
</script>
</body>
</html>
